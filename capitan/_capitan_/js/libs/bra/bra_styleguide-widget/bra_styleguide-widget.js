/**
 * Copyright brandung GmbH & Co.KG
 * http://www.brandung.de/
 *
 * Date: 2019-01-12
 * MIT License (MIT)
 */

(function(a){var b={settings:{isStickyHeader:!0,stickyHeader:".main-nav-wrapper",compParam:"comp",hideParam:"hide",deleteParam:"delete",dataEl:"sg",dataSection:"sg__section",dataComponent:"sg__component",dataSubline:"sg__subline",dataName:"name",classes:{styleguide:"sg",wgt:"sg__wgt",wgtHeader:"sg__wgt-header",wgtContainer:"sg__wgt-container",wgtCheck:"sg__wgt-check",ctrRemove:"sg__ctr-remove",ctrOpen:"sg__ctr-open",ctrGrid:"sg__ctr-grid",ctrCheck:"sg__ctr-check",showGrid:"sg__show-grid",gridOverlay:"sg__grid-overlay",hl:"sg__hl",hlSection:"--section",hlComponent:"--component",hlSubline:"--subline"}},tpl:{$col:'<div class="col-xs-3 col-sm-2 col-lg-1"></div>',columns:12}},c={};return c.addWidget=function(){var d=b.settings.classes;b.settings.widget=a('<div class="'+d.wgt+'"><div class="'+d.wgtHeader+'">\t<h3>Styleguide</h3><span class="'+d.ctrRemove+'" title="Remove">Remove</span><span class="'+d.ctrGrid+'" title="Show grid">Show grid</span><span class="'+d.ctrCheck+'" title="Toggle modules">Toggle modules</span><span class="'+d.ctrOpen+'" title="Show module list">Open</span></div><div class="'+d.wgtContainer+'"></div></div>'),c.addSectionHeaders(),c.addGrid(),b.settings.widget.appendTo("body"),b.selectors={$wgt:a("."+d.wgt),$wgtContainer:a("."+d.wgtContainer),$wgtCheck:a("."+d.wgtCheck),$dataRole:a('[data-role="'+b.settings.dataEl+'"]')},c.getDeepLinks(),c.addListener(),b.showComponent(),b.hideWidget(),b.deleteComponents()},c.addSectionHeaders=function(){var c=b.settings.classes;a('[data-role="'+b.settings.dataEl+'"]').each(function(){var d=a(this);switch(d.data("type")){case b.settings.dataComponent:d.prepend('<h3 class="'+c.hl+" "+c.hl+c.hlComponent+'">'+d.data(b.settings.dataName)+"</h3>");break;case b.settings.dataSubline:d.prepend('<h4 class="'+c.hl+" "+c.hl+c.hlSubline+'">'+d.data(b.settings.dataName)+"</h4>");break;default:d.prepend('<h2 class="'+c.hl+" "+c.hl+c.hlSection+'">'+d.data(b.settings.dataName)+"</h2>")}"hidden"==d.data("headline")&&d.find("."+c.hl).hide()})},c.addGrid=function(){var c=b.settings.classes,d=['<div class="'+c.gridOverlay+'">','<div class="container">','<div class="row">',""+function(){for(var a="",c=0;c<b.tpl.columns;c++)a+=b.tpl.$col+"\n";return a}(),"</div>","</div>","</div>"].join("\n");b.settings.grid=a(d),b.settings.grid.appendTo("body")},c.addListener=function(){var d=b.settings.classes;Capitan.Vars.$doc.on("on-changed-breakpoint",c.handleBreakpointChange),b.settings.widget.find("."+d.ctrOpen).on("click",function(){a(this).toggleClass("is-active"),b.selectors.$wgt.toggleClass("is-open")}),b.settings.widget.find("."+d.ctrCheck).on("click",function(){a(this).toggleClass("is-active"),c.toggleModules()}),b.settings.widget.find("."+d.ctrGrid).on("click",function(){a(this).toggleClass("is-active"),a("body").toggleClass(b.settings.classes.showGrid)}),b.settings.widget.find("."+d.ctrRemove).on("click",function(){b.settings.widget.remove(),b.settings.grid.remove(),a("body").removeClass(b.settings.classes.styleguide)}),a("body").on("change",b.selectors.$wgtCheck.selector,function(){var b=a(this);c.showHideModules.call(b)})},c.showHideModules=function(){var c=this,d=a.trim(c.prev().text()),e=c.is(":checked"),f=c.parent().data("listtype")==b.settings.dataSection,g=null;g=f?c.parent().nextUntil('[data-listtype="'+b.settings.dataSection+'"]'):c.parent().prevAll('[data-listtype="'+b.settings.dataSection+'"]:first'),e?(a('[data-name="'+d+'"]').show(),g.each(function(){var b=a(this),c=a.trim(b.text());b.find("input").prop("checked",!0),a('[data-name="'+c+'"]').show()})):(a('[data-name="'+d+'"]').hide(),f&&g.each(function(){var b=a(this),c=a.trim(b.text());b.find("input").prop("checked",!1),a('[data-name="'+c+'"]').hide()}))},c.toggleModules=function(){var c=b.settings.classes;b.settings.widget.find("."+c.ctrCheck).hasClass("is-active")?b.settings.widget.find("."+c.wgtCheck).each(function(){a(this).prop("checked",!1).change()}):b.settings.widget.find("."+c.wgtCheck).each(function(){a(this).prop("checked",!0).change()})},c.getDeepLinks=function(){var c=b.settings.classes,d=a("<ul></ul>");b.selectors.$dataRole.each(function(){var e=a(this),f=e.data(b.settings.dataName);/^\d+\.\W/gi.test(f)||(f="&nbsp;&nbsp;&nbsp; "+f),a('<li data-listtype="'+e.data("type")+'"><span>'+f+'</span><input class="'+c.wgtCheck+'" type="checkbox" checked name="text" /></li>').appendTo(d)}),d.find("li").on("click",function(){var c=a(this),d=a.trim(c.text()),e=0;b.settings.isStickyHeader&&(e=a(b.settings.stickyHeader).height()),b.selectors.$dataRole.each(function(){if(a(this).data(b.settings.dataName)===d){var c=a(this).offset().top-e;return a("body").stop().animate({scrollTop:c},"fast",function(){return!1}),!1}})}),d.appendTo(b.selectors.$wgtContainer)},c.handleBreakpointChange=function(){Capitan.Function.assertBreakpoint("lt","md")?b.selectors.$wgt.addClass("is-mobile"):b.selectors.$wgt.removeClass("is-mobile")},c.getParam=function(a){for(var b=window.location.search.substr(1).split("&"),c=0;c<b.length;c++){var d=b[c].split("=");if(d[0]==a)return decodeURIComponent(d[1])}return!1},b.showComponent=function(){var d=b.settings.classes;c.getParam(b.settings.compParam)&&(b.settings.widget.find("."+d.ctrCheck).click(),b.settings.widget.find("."+d.wgtCheck).each(function(){var d=a(this);if(a.trim(d.prev().text()).toLowerCase()===c.getParam(b.settings.compParam).toLowerCase())return d.click(),!1}))},b.hideWidget=function(){"true"===c.getParam(b.settings.hideParam)&&b.settings.widget.remove()},b.deleteComponents=function(){"true"===c.getParam(b.settings.deleteParam)&&b.selectors.$dataRole.each(function(){var b=a(this);b.is(":hidden")&&b.remove()})},b.init=function(d){var e=b.settings.classes;b.settings=a.extend(b.settings,d),a("body").addClass(e.styleguide),c.addWidget(),c.handleBreakpointChange()},b})(jQuery).init();