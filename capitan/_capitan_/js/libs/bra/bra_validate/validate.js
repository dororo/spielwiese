/**
 * Copyright brandung GmbH & Co.KG
 * http://www.brandung.de/
 *
 * Date: 2019-01-12
 * MIT License (MIT)
 */

!function(a,b,c,d){"use strict";function e(b,c){this.element=b,this.$el=a(this.element);var d=this.$el.data();this.options=a.extend(!0,{},h,c,d),this._defaults=h,this._name=f,this.init()}var f="validate",g=(a(b),b.requestAnimationFrame||b.setTimeout),h=(b.cancelAnimationFrame||b.clearTimeout,{disableAutocompletion:!1,disableSubmitButtons:!1,sendFormViaAjax:!1,errorMessages:{defaultMessage:"defaultMessage | please fill this field correctly",badInput:"badInput | please fill this field correctly",customError:"customError | please fill this field correctly",patternMismatch:"patternMismatch | please fill this field correctly",rangeOverflow:"rangeOverflow | please fill this field correctly",rangeUnderflow:"rangeUnderflow | please fill this field correctly",stepMismatch:"stepMismatch | please fill this field correctly",tooLong:"tooLong | please fill this field correctly",tooShort:"tooShort | please fill this field correctly",typeMismatch:"typeMismatch | please fill this field correctly",valueMissing:"valueMissing | please fill this field correctly"},selectors:{inputBox:".form__field-wrapper",inputErrorBox:".form__error",errorMessages:"small"},classes:{userError:"user-error",valid:"is-valid",invalid:"is-invalid",disabled:"is-disabled",fallbackMessage:"is-fallback-message"},callbacks:{init:function(a){},willDestory:function(a){},afterValidation:function(a){}},markup:{inputErrorBox:'<div class="form__error" />',errorMessage:"<small />"}});a.extend(e.prototype,{init:function(){var a=this;a.options;a.id=this.$el.prop("id")||a.getId(),a._queryElements(),a._disableDefaultValidation(),a._bindEvents(),a._checkValidityStates(),a._updateSubmitButtons(),b.validationInstance=a,b.validationForm=a.element,a._callback("init")},_queryElements:function(){var b=this,c=b.options;c.selectors;b.$form=b.$el.is("form")?b.$el:a("form",b.$el).first(),b.inputElements=a("input, select, textarea",b.$el),b.inputBoxes=a(c.selectors.inputBox,b.$el),b.inputErrorBoxes=b._getOrCreateErrorBoxes(),b.submitButtons=a(b.$el[0].elements).filter(function(){return"submit"===this.type})},_getOrCreateErrorBoxes:function(){var b=this,c=b.options;return b.inputBoxes.map(function(b,d){var e,f=a(d),g=a(c.selectors.inputErrorBox,d)[0]||a(c.markup.inputErrorBox).appendTo(d)[0],h=a(c.selectors.errorMessages,g||{});return 0===h.length&&(e=a("[data-error-message]",f).data("error-message"))&&(h=a(c.markup.errorMessage).appendTo(g).first(),h.text(e)),g})},_getInvalidInputs:function(){var a=this;a.options;return a.inputElements.filter(function(){return!this.validity.valid})},_bindEvents:function(){var a=this,b=a.options;b.selectors;a.inputElements.on("focusin",function(b){a._setInputData(b.target,{userInteracted:!0})}),a.inputElements.on("input",function(b){a._checkValidityStates(this,b),a._updateSubmitButtons()}),a.inputElements.on("change focusout",function(b){a._checkValidityStates(this,b),a._updateSubmitButtons()}),a.$form.on("reset",function(b){a._setInputData(a.inputElements,{userInteracted:!1}),setTimeout(function(){a._checkValidityStates(a.inputElements,b),a._updateSubmitButtons()})}),a.$form.on("submit",function(b){a._userSubmitIntent(b)})},_userSubmitIntent:function(a){var b=this,c=b.options,d=b.$form[0].checkValidity();c.sendFormViaAjax?(a.preventDefault(),d?b._callback("afterValidation",{validation:!0}):b._callback("afterValidation",{validation:!1})):!d&&a.preventDefault(),b._checkValidityStates(b.inputElements,a),b._updateSubmitButtons(),b._getInvalidInputs()[0].focus()},_setInputData:function(b,c){var d=this,e=(d.options,a(b));if(!b||b.length>1&&!b.tagName)return e=b||d.inputElements,void e.each(function(a,b){d._setInputData(b,c)});var f=(e[0],e.data(d.id)||{});e.data(d.id,a.extend(!0,f,c))},_checkValidityStates:function(b,c){var d,e,f=this,h=(f.options,c||{});if(!b||b.length>1&&!b.tagName)return e=b||f.inputElements,void e.each(function(a,b){f._checkValidityStates(b,h)});var e=a(b),d=e[0],i=d.validity.valid;(h.type&&"input"!==h.type||i)&&g(function(){f._updateValidationUI(d,h)})},_updateValidationUI:function(b,c){var d,e,f=this,g=f.options,h=c||{};if(!b||b.length>1&&!b.tagName)return e=b||f.inputElements,void e.each(function(a,b){f._checkValidityStates(b,h)});var e=a(b),d=e[0],i=e.closest(g.selectors.inputBox),j=a(g.selectors.inputErrorBox,i||{}),k=(f.inputBoxes.index(i),d.validity),l=k.valid;(e.data(f.id)||{}).userInteracted||"submit"===h.type?(f._updateInputErrorBox(j,a.extend({},k,{validationMessage:d.validationMessage})),i.add(e).addClass(g.classes[l?"valid":"invalid"]).removeClass(g.classes[l?"invalid":"valid"])):"reset"===h.type&&(j.attr("hidden",!0),i.add(e).removeClass(g.classes.invalid).removeClass(g.classes.valid))},_updateInputErrorBox:function(b,c){var d,e=this,f=e.options,g=a(b),h=a(f.selectors.errorMessages,g||{}),i=e.getValidationStateGrouped(c);if(h.attr("hidden",!0),d=h.filter(function(){var b=(a(this).data("errorTypes")||"").split(" "),c=!1;return b.forEach(function(a){c=c||-1!==i.activeStates.indexOf(a)}),c}),!c.valid&&0===d.length&&(d=h.last(),0===d.length||d.hasClass(f.classes.fallbackMessage))){var j=i.activeStates[0];d=a(f.markup.errorMessage),d.attr("data-error-types",j).addClass(f.classes.fallbackMessage).prependTo(g).text(f.errorMessages[j]||f.errorMessages.defaultMessage||void 0)}d.first().attr("hidden",!1),g.attr("data-current-error-types",i.activeStates.join(" ")).attr("hidden",c.valid)},getValidationStateGrouped:function(a){var b=this,c=(b.options,{valid:a.valid,activeStates:[],inactiveStates:[]});for(var d in a)!0===a[d]?c.activeStates.push(d):c.inactiveStates.push(d);return c},_disableDefaultValidation:function(){var a=this,b=a.options;a.$el.prop("noValidate",!0),b.disableAutocompletion&&a.$el.prop("autocomplete","off")},_updateSubmitButtons:function(){var a=this,b=a.options,c=a.$form[0].checkValidity();b.disableSubmitButtons&&a.submitButtons.prop("disabled",!c),a.submitButtons[c?"removeClass":"addClass"](b.classes.disabled)},nsEvent:function(a){var b=this;if(a)return a.split(" ").map(function(a){return a+"."+b.id}).join(" ")},_callback:function(a,b){var c=this,d=c.options;if(a in this._defaults.callbacks)return d.callbacks[a](b)},destroy:function(){self._callback("willDestory")},getId:function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return function(b){return[b?f+"_"+b:f,a(),a(),a(),a()].join("-")}}()}),a.fn[f]=function(b){return this.each(function(){a.data(this,f)||a.data(this,f,new e(this,b))})}}(jQuery,window,document);